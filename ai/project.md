# 專案開發日誌：Python 台灣天氣查詢器

本文檔記錄了從專案初始化到最終完成的整個開發流程與決策過程。

---

## 1. 專案初始化 (Project Initialization)
*   **目標**：建立一個 Python 桌面應用程式，用於查詢並視覺化台灣 22 個縣市的即時天氣，並達成課程的「進階挑戰」要求。
*   **初始狀態**：擁有一個 `test_api.py` 腳本，用於測試 OpenWeatherMap API，但在執行時遇到 `狀態碼: 401 (Invalid API key)` 的問題。

## 2. 第一階段：建立基礎架構與 GUI (Phase 1: Scaffolding & GUI)
*   **專案重構**：為了更好的程式碼結構，刪除了 `test_api.py`，並建立了兩個核心模組：
    *   `main.py`：用於處理 GUI 介面與主程式邏輯。
    *   `weather_api.py`：專門用於處理所有與 API 相關的邏輯。
*   **靜態 GUI**：使用 `PySimpleGUI` 模組在 `main.py` 中建立了應用的基礎介面，包含標題、縣市下拉選單、查詢按鈕及資訊顯示區。
*   **環境偵錯**：在初次執行 `main.py` 時，遇到了 `AttributeError`。經查，這是由於 `PySimpleGUI` 版本問題導致，透過官方建議的指令重新安裝後解決。

## 3. 第二階段：API 串接與圖表功能 (Phase 2: API & Chart Integration)
*   **API 生效**：再次測試後，確認 OpenWeatherMap 的 API Key 已啟用，可以成功獲取天氣資料。
*   **整合 Matplotlib**：在 `main.py` 中加入了 `matplotlib` 的整合，實現了點擊按鈕後，獲取全部 22 縣市的溫度資料，並繪製成長條圖顯示在 GUI 介面中。

## 4. 第三階段：功能優化與重構 (Phase 3: Refinement & Refactoring)
*   **API Key 配置化**：為了安全性與可維護性，將寫死在程式碼中的 API Key 移至一個獨立的 `config.ini` 設定檔中。同時建立了 `.gitignore` 檔案來忽略此設定檔，避免敏感資訊外洩。
*   **增加天氣資訊**：擴充了單點查詢的功能，在介面上增加了「體感溫度」、「濕度」、「風速」等更詳細的資訊。
*   **新增載入指示器**：為了改善使用者體驗，在執行耗時較長的「查詢全部縣市」功能時，加入了禁用按鈕的載入指示器，防止重複點擊並給予使用者反饋。

## 5. 第四階段：重大重構 - 更換 API (Phase 4: Major Refactoring - API Change)
*   **需求變更**：使用者提出將「風速」欄位改為顯示「降雨機率」。
*   **API 限制分析**：經分析，發現原先使用的 OpenWeatherMap 免費即時天氣 API **不提供**「降雨機率」這項預報資料。
*   **更換 API**：在與使用者溝通後，決定更換為資料更權威、且免費提供預報資料的台灣**「中央氣象署 (CWA)」**開放資料平台 API。
*   **重寫核心邏輯**：
    *   使用者註冊並提供了新的 CWA API 授權碼。
    *   更新了 `config.ini` 以儲存新的授權碼。
    *   完全重寫了 `weather_api.py`，以串接新的 CWA API 端點 (`F-C0032-001` 資料集)。
    *   修改了 `main.py` 的介面與邏輯，以配合新的 API 資料結構，並成功顯示「降雨機率」。

## 6. 第五階段：偵錯與最終完善 (Phase 5: Debugging & Finalization)
*   **SSL 錯誤**：在串接 CWA API 時，使用者的環境出現 `SSLError` 憑證驗證失敗。透過在 `requests.get()` 中加入 `verify=False` 參數繞過驗證，解決了此環境問題。
*   **解析錯誤 (Parsing Error)**：解決 SSL 問題後，程式在解析 API 回傳的 JSON 資料時發生 `KeyError`。透過**多次**迭代偵錯（將 API 原始回應寫入 `json` 日誌檔案進行分析），最終掌握了 CWA API 正確的資料結構，並修正了解析邏輯。
*   **工具錯誤**：在偵錯過程中，Gemini 的 `replace` 工具發生了數次錯誤，將其自身的錯誤訊息寫入了 `main.py`，導致檔案損毀。最終改用 `write_file` 直接覆蓋檔案的方式，才成功修復並加入偵錯程式碼。
*   **日誌管理**：根據使用者要求，刪除了所有在偵錯過程中產生的日誌檔案，並加入了新功能：未來若再發生錯誤，會自動建立 `error_logs` 資料夾，並將日誌存放其中。

## 7. 第六階段：介面美化與優化 (Phase 6: UI Beautification & Optimization)
*   **圖表美化**：根據使用者回饋，對 `matplotlib` 圖表進行了大幅美化：
    *   套用了 `seaborn-v0_8-darkgrid` 樣式。
    *   根據溫度高低，為長條圖加上了從藍到紅的漸層色。
    *   在每個長條圖頂端加上了溫度的具體數值。
    *   加上了水平格線以利閱讀。
    *   修正了因套用樣式導致中文字型被覆蓋，文字無法顯示的問題。
*   **GUI 介面優化**：
    *   **深色主題**：為了實現使用者期望的現代感，將整體介面改為 `DarkGrey14` 深色主題。
    *   **天氣圖示**：在單點查詢的結果中，加入了對應天氣狀況的 Emoji 圖示 (☀️, ☁️, 🌧️)，讓介面更直觀。
    *   **圖示偵錯**：解決了因天氣代碼格式不符 (`6` vs `06`) 導致圖示無法顯示的問題。
    *   **佈局修正**：修復了在查詢圖表時，狀態文字會覆蓋天氣資訊的佈局問題，為其新增了獨立的狀態列。

## 最終狀態 (Final State) - 更新
*   專案功能完整，完全符合課程的「進階挑戰」要求。
*   使用中央氣象署官方 API，可查詢天氣現象、溫度及降雨機率。
*   可繪製**經過美化的** 22 縣市溫度長條圖（含漸層色彩、數值標示）。
*   GUI 介面為**深色主題**，並包含天氣**圖示**，整體更具現代感。
*   程式碼結構清晰（GUI 與 API 模組分離），具備完整的錯誤處理與日誌管理功能。