# 台灣天氣查詢 App - 專案完整文件 (Project Documentation)

## 1. 專案概覽 (Project Overview)

### 1.1 基本資訊
*   **程式語言**: Python 3
*   **資料來源**: 中央氣象署 (CWA) 開放資料平台 API (`F-C0032-001`)
*   **主要套件**: `PySimpleGUI` (介面), `requests` (網路), `matplotlib` (圖表)

### 1.2 核心功能總結
1.  **36 小時詳細預報**:
    *   提供未來三個時段（今晚、明早、明晚）的天氣預報。
    *   顯示資訊：時間範圍、天氣圖示 (Emoji)、天氣現象、溫度範圍、降雨機率。
2.  **全台天氣概覽**:
    *   一鍵查詢台灣 22 個縣市即時天氣。
    *   繪製美觀的溫度分佈長條圖（含漸層色與數值標示）。
3.  **自動化與即時性**:
    *   **自動更新**: 每 10 分鐘自動背景更新資料。
    *   **即時狀態**: 顯示最後更新時間，確保資料時效。
4.  **現代化介面**:
    *   採用深色主題 (DarkGrey14)，降低視覺疲勞。
    *   具備錯誤捕捉與彈出視窗機制，提升穩定性。

---

## 2. 專案開發日誌 (Development Log)

### 1. 專案初始化 (Project Initialization)
*   **目標**：建立一個 Python 桌面應用程式，用於查詢並視覺化台灣 22 個縣市的即時天氣，並達成課程的「進階挑戰」要求。
*   **初始狀態**：擁有一個 `test_api.py` 腳本，用於測試 OpenWeatherMap API，但在執行時遇到 `狀態碼: 401 (Invalid API key)` 的問題。

### 2. 第一階段：建立基礎架構與 GUI (Phase 1: Scaffolding & GUI)
*   **專案重構**：為了更好的程式碼結構，刪除了 `test_api.py`，並建立了兩個核心模組：
    *   `main.py`：用於處理 GUI 介面與主程式邏輯。
    *   `weather_api.py`：專門用於處理所有與 API 相關的邏輯。
*   **靜態 GUI**：使用 `PySimpleGUI` 模組在 `main.py` 中建立了應用的基礎介面，包含標題、縣市下拉選單、查詢按鈕及資訊顯示區。
*   **環境偵錯**：在初次執行 `main.py` 時，遇到了 `AttributeError`。經查，這是由於 `PySimpleGUI` 版本問題導致，透過官方建議的指令重新安裝後解決。

### 3. 第二階段：API 串接與圖表功能 (Phase 2: API & Chart Integration)
*   **API 生效**：再次測試後，確認 OpenWeatherMap 的 API Key 已啟用，可以成功獲取天氣資料。
*   **整合 Matplotlib**：在 `main.py` 中加入了 `matplotlib` 的整合，實現了點擊按鈕後，獲取全部 22 縣市的溫度資料，並繪製成長條圖顯示在 GUI 介面中。

### 4. 第三階段：功能優化與重構 (Phase 3: Refinement & Refactoring)
*   **API Key 配置化**：為了安全性與可維護性，將寫死在程式碼中的 API Key 移至一個獨立的 `config.ini` 設定檔中。同時建立了 `.gitignore` 檔案來忽略此設定檔，避免敏感資訊外洩。
*   **增加天氣資訊**：擴充了單點查詢的功能，在介面上增加了「體感溫度」、「濕度」、「風速」等更詳細的資訊。
*   **新增載入指示器**：為了改善使用者體驗，在執行耗時較長的「查詢全部縣市」功能時，加入了禁用按鈕的載入指示器，防止重複點擊並給予使用者反饋。

### 5. 第四階段：重大重構 - 更換 API (Phase 4: Major Refactoring - API Change)
*   **需求變更**：使用者提出將「風速」欄位改為顯示「降雨機率」。
*   **API 限制分析**：經分析，發現原先使用的 OpenWeatherMap 免費即時天氣 API **不提供**「降雨機率」這項預報資料。
*   **更換 API**：在與使用者溝通後，決定更換為資料更權威、且免費提供預報資料的台灣**「中央氣象署 (CWA)」**開放資料平台 API。
*   **重寫核心邏輯**：
    *   使用者註冊並提供了新的 CWA API 授權碼。
    *   更新了 `config.ini` 以儲存新的授權碼。
    *   完全重寫了 `weather_api.py`，以串接新的 CWA API 端點 (`F-C0032-001` 資料集)。
    *   修改了 `main.py` 的介面與邏輯，以配合新的 API 資料結構，並成功顯示「降雨機率」。

### 6. 第五階段：偵錯與最終完善 (Phase 5: Debugging & Finalization)
*   **SSL 錯誤**：在串接 CWA API 時，使用者的環境出現 `SSLError` 憑證驗證失敗。透過在 `requests.get()` 中加入 `verify=False` 參數繞過驗證，解決了此環境問題。
*   **解析錯誤 (Parsing Error)**：解決 SSL 問題後，程式在解析 API 回傳的 JSON 資料時發生 `KeyError`。透過**多次**迭代偵錯（將 API 原始回應寫入 `json` 日誌檔案進行分析），最終掌握了 CWA API 正確的資料結構，並修正了解析邏輯。
*   **工具錯誤**：在偵錯過程中，Gemini 的 `replace` 工具發生了數次錯誤，將其自身的錯誤訊息寫入了 `main.py`，導致檔案損毀。最終改用 `write_file` 直接覆蓋檔案的方式，才成功修復並加入偵錯程式碼。
*   **日誌管理**：根據使用者要求，刪除了所有在偵錯過程中產生的日誌檔案，並加入了新功能：未來若再發生錯誤，會自動建立 `error_logs` 資料夾，並將日誌存放其中。

### 7. 第六階段：介面美化與優化 (Phase 6: UI Beautification & Optimization)
*   **圖表美化**：根據使用者回饋，對 `matplotlib` 圖表進行了大幅美化：
    *   套用了 `seaborn-v0_8-darkgrid` 樣式。
    *   根據溫度高低，為長條圖加上了從藍到紅的漸層色。
    *   在每個長條圖頂端加上了溫度的具體數值。
    *   加上了水平格線以利閱讀。
    *   修正了因套用樣式導致中文字型被覆蓋，文字無法顯示的問題。
*   **GUI 介面優化**：
    *   **深色主題**：為了實現使用者期望的現代感，將整體介面改為 `DarkGrey14` 深色主題。
    *   **天氣圖示**：在單點查詢的結果中，加入了對應天氣狀況的 Emoji 圖示 (☀️, ☁️, 🌧️)，讓介面更直觀。
    *   **圖示偵錯**：解決了因天氣代碼格式不符 (`6` vs `06`) 導致圖示無法顯示的問題。
    *   **佈局修正**：修復了在查詢圖表時，狀態文字會覆蓋天氣資訊的佈局問題，為其新增了獨立的狀態列。

### 8. 第七階段：功能擴充 - 36 小時天氣預報 (Phase 7: Feature Expansion - 36-Hour Forecast)
*   **功能升級**：將原本的「單一縣市查詢」功能進行了重大升級。
*   **API 資料深度利用**：修改 `weather_api.py`，不再僅讀取 API 回傳的第一筆資料，而是完整解析未來 36 小時的三個時段（每 12 小時一區間）的預報資料。
*   **GUI 介面重構**：
    *   修改 `main.py` 的版面配置，將單一資訊欄位改為三個並排的顯示區塊。
    *   每個區塊獨立顯示該時段的時間範圍、天氣圖示、天氣現象描述、溫度範圍（最低溫~最高溫）及降雨機率。
*   **成果**：使用者現在可以一次掌握「今晚、明早、明晚」的天氣變化，大幅提升了應用程式的實用性與資訊豐富度。

### 9. 第八階段：自動化與即時性 (Phase 8: Automation & Real-time Updates)
*   **自動更新 (Auto-Refresh)**：實作了背景自動更新機制。
    *   設定應用程式每隔 **10 分鐘** 自動重新向 CWA API 請求最新資料。
    *   利用 `PySimpleGUI` 的 `timeout` 事件迴圈機制，確保介面在等待更新時不會凍結。
*   **狀態回饋**：
    *   新增「最後更新時間」顯示，讓使用者明確知道目前顯示的資料時效性。
*   **成果**：使用者無需手動點擊重新整理，掛機也能隨時掌握最新天氣，體驗更接近專業儀表板。

### 10. 第九階段：穩定性修復 (Phase 9: Debugging & Stability)
*   **NameError 修復**：
    *   在實作自動更新功能時，因漏掉 `import datetime` 導致程式閃退。
    *   已補上遺失的 import 語句，並加入全域錯誤捕捉機制 (Global Exception Handling)，防止未來因未預期錯誤導致程式直接崩潰。
*   **檔案同步問題解決**：
    *   發現使用者的編輯器與自動化工具發生存檔衝突，導致 `main.py` 檔案內容被截斷。
    *   透過完整重寫檔案並請使用者關閉編輯器，成功解決了檔案損毀問題。
*   **成果**：程式恢復正常運作，且具備更強的容錯能力。

## 11. 第十階段：貼心生活建議 (Phase 10: Lifestyle Suggestions)
*   **功能目標**：不只是顯示冷冰冰的數據，而是根據天氣狀況提供人性化的穿衣與生活建議。
*   **邏輯實作**：
    *   在 `weather_api.py` 新增 `get_lifestyle_advice` 函式。
    *   **下雨** (降雨機率 > 70%)：提醒帶傘。
    *   **炎熱** (最高溫 ≥ 30°C)：提醒防曬、補水。
    *   **寒冷** (最低溫 < 15°C)：提醒保暖。
    *   **溫差大** (溫差 ≥ 10°C)：提醒洋蔥式穿搭。
*   **介面整合**：
    *   在 `main.py` 的天氣預報區塊下方，新增醒目的黃色文字區域。
    *   當查詢天氣時，自動計算並顯示對應的建議文字。
*   **成果**：App 變得更有溫度，能像朋友一樣提醒使用者「出門記得帶傘」或「天氣變冷了」。

## 12. 未來開發藍圖 (Future Roadmap)
以下為待開發的 10 項潛在功能：
1.  **地點搜尋功能 (Location Search)**：支援鄉鎮市區查詢。
2.  **溫度單位切換 (Unit Switching)**：攝氏/華氏切換。
3.  **多日天氣預報 (Multi-day Forecast)**：擴充至未來一週預報。
4.  **天氣趨勢圖 (Weather Trend Chart)**：用折線圖看溫度變化。
5.  **桌面通知 (Desktop Notifications)**：降雨或極端天氣跳出提醒。
6.  **空氣品質顯示 (AQI Display)**：整合 PM2.5 數據，關心呼吸健康。
7.  **天氣警報推播 (Weather Warnings)**：顯示颱風、豪大雨特報。
8.  **主題切換 (Theme Customization)**：淺色/深色模式自由切換。
9.  **資料匯出 (Export Data)**：將天氣資料存成 CSV 檔做紀錄。
10. **縮小至系統列 (System Tray)**：常駐在右下角，不佔用工作列空間。

---

## 3. 原始專案企劃 (Original Proposal)

### 1. 專案簡介
本專案旨在開發一個使用者友善的桌面天氣查詢應用程式，讓使用者能夠輕鬆查詢台灣 22 個縣市的即時天氣資訊。應用程式提供單一縣市查詢功能，並能將所有縣市的溫度資料視覺化呈現於圖表中，幫助使用者快速掌握全台天氣概況。

### 2. 專案目標
*   提供直觀且易於操作的圖形化使用者介面 (GUI)。
*   整合中央氣象署 (CWA) 的開放資料 API，獲取可靠的天氣資訊。
*   支援台灣 22 個縣市的天氣查詢。
*   實現單一縣市詳細天氣資訊顯示，包含天氣現象、溫度和降雨機率。
*   提供全台縣市溫度分佈圖表，以視覺化方式呈現數據。
*   具備錯誤處理機制，確保 API 呼叫失敗時能妥善處理並提供使用者反饋。

### 3. 功能特色
#### 3.1. 使用者介面 (GUI)
*   **縣市選擇器**: 提供下拉式選單，供使用者選擇欲查詢的台灣縣市。
*   **單一縣市查詢**: 點擊按鈕後，顯示所選縣市的即時天氣資訊。
*   **全台縣市查詢與圖表**: 點擊按鈕後，查詢所有 22 個縣市的溫度，並以長條圖形式呈現溫度分佈。
*   **天氣資訊顯示**: 包含天氣現象描述、當前溫度和降雨機率。
*   **天氣圖示**: 根據天氣代碼顯示對應的視覺化天氣圖示。
*   **狀態欄**: 提供操作過程中的即時回饋訊息（例如：「正在查詢...」、「查詢完成！」）。

#### 3.2. 後端服務與資料處理
*   **CWA API 整合**: 使用 `requests` 函式庫呼叫中央氣象署開放資料平台 (F-C0032-001) 的 API。
*   **API 金鑰管理**: 從 `config.ini` 檔案安全讀取 API 金鑰。
*   **資料解析**: 解析 API 回傳的 JSON 格式資料，提取關鍵天氣元素 (天氣現象、天氣代碼、最高溫度、降雨機率)。
*   **錯誤處理與日誌**: 當 API 呼叫失敗或資料處理異常時，捕捉錯誤並將原始 API 回應儲存至 `error_logs` 資料夾，便於問題追蹤。

### 4. 技術架構
*   **前端介面**: Python `PySimpleGUI` 函式庫，用於快速建構輕量級桌面 GUI 應用程式。
*   **圖表繪製**: Python `matplotlib` 函式庫，用於生成美觀的溫度分佈長條圖。
*   **API 請求**: Python `requests` 函式庫，用於處理 HTTP 網路請求。
*   **配置管理**: Python `configparser` 函式庫，用於讀取應用程式配置 (例如 API 金鑰)。
*   **作業系統**: 跨平台支援 (Python 環境下)。